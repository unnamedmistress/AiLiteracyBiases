<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self';">
    <title>Game: Memory Leak Scenario</title>
    
    <link rel="stylesheet" href="../styles/shared.css">
    <style>
        .scenario-card {
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            padding: 24px;
            margin-top: 24px;
        }
        .scenario-text {
            font-size: 17px;
            line-height: 1.7;
            padding: 18px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }
        .options-grid { display: grid; gap: 12px; }
        .option-btn {
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 16px;
            background: rgba(255, 255, 255, 0.04);
            color: inherit;
            cursor: pointer;
            text-align: left;
            transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        .option-btn:hover:not([disabled]) { transform: translateY(-2px); border-color: rgba(0, 217, 255, 0.6); background: rgba(255, 255, 255, 0.08); }
        .option-btn[disabled] { opacity: 0.7; cursor: not-allowed; }
        .option-btn.correct { border-color: #10B981; background: rgba(16, 185, 129, 0.15); }
        .option-btn.incorrect { border-color: #EF4444; background: rgba(239, 68, 68, 0.15); }
        .option-letter { font-weight: 700; font-size: 18px; min-width: 24px; }
        .feedback-box { border-radius: var(--radius-md); padding: 16px; margin-top: 16px; display: none; }
        .feedback-box.show { display: block; }
        .feedback-box.correct { border: 1px solid #10B981; background: rgba(16, 185, 129, 0.1); color: #34d399; }
        .feedback-box.incorrect { border: 1px solid #EF4444; background: rgba(239, 68, 68, 0.1); color: #f87171; }
        .explanation { margin-top: 12px; color: var(--color-muted); font-size: 14px; }
        .memory-debug {
            margin-top: 24px;
            padding: 18px;
            border-radius: var(--radius-md);
            border: 1px dashed rgba(0, 217, 255, 0.45);
            background: rgba(0, 217, 255, 0.08);
        }
        .memory-debug ul {
            margin: 12px 0 0;
            padding-left: 18px;
        }
        .memory-debug li { margin-bottom: 6px; }
    </style>
    <script defer src="../scripts/shared.js"></script>
    <script defer src="../scripts/progress.js"></script>
    <script defer src="../scripts/nav.js"></script>
</head>
<body data-lesson-id="lesson2" data-total-pages="12" data-page-number="9">
    <div class="container lesson-shell">
        <div class="header">
            <div class="logo">üß† Game: Memory Leak</div>
            <div class="breadcrumb"></div>
        </div>

        <div class="challenge-section">
            <h1 class="challenge-title">Diagnose the Glitch</h1>
            <p class="challenge-desc">You gave the AI a 20-step product brief. Toward the end, everything fell apart. Which pathology is most likely?</p>

            <div class="scenario-card">
                <div class="scenario-text">
"Thanks for the detailed product brief! Here's your final landing page copy: (1) Bullet list repeating steps 1-3 from your spec word-for-word, (2) Another paragraph apologizing because I ‚Äúcan‚Äôt access the internet,‚Äù (3) Final CTA in Shakespearean voice like you asked earlier."<br><br>
                </div>
                <p style="font-weight: 600; margin-bottom: 12px;">What's your diagnosis?</p>
                <div class="options-grid">
                    <button class="option-btn" data-option="0">
                        <span class="option-letter">A.</span>
                        <span>Machine DID ‚Äì multiple personas collided.</span>
                    </button>
                    <button class="option-btn" data-option="1">
                        <span class="option-letter">B.</span>
                        <span>Context Amnesia ‚Äì the brief overflowed the window so it fell back to earlier chunks.</span>
                    </button>
                    <button class="option-btn" data-option="2">
                        <span class="option-letter">C.</span>
                        <span>AI M√ºnchausen ‚Äì it's refusing to work.</span>
                    </button>
                    <button class="option-btn" data-option="3">
                        <span class="option-letter">D.</span>
                        <span>Verbosity ‚Äì it just loves long answers.</span>
                    </button>
                </div>
                <div class="feedback-box" id="memoryFeedback">
                    <div id="memoryResult"></div>
                    <div class="explanation" id="memoryExplanation"></div>
                </div>
            </div>

            <div class="memory-debug">
                <strong>üß™ Debug It Fast:</strong>
                <ul>
                    <li>Summarize your instructions in 5 bullet points and resend.</li>
                    <li>Use "You are now in step 4 of 5" reminders to anchor context.</li>
                    <li>Break long briefs into smaller calls.</li>
                </ul>
            </div>

            <div class="progress-indicator">Page 9 of 12 ‚Ä¢ Memory Game</div>
            <div class="progress-nav">
                <button class="btn-next" id="memoryNext" disabled onclick="window.location.href='l2-p10-learn-facts.html'">Next: Learn the F.A.C.T.S. Safety Check ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const LESSON_ID = 'lesson2';
            const PAGE_ID = 'l2-p9';
            const tracker = window.ProgressTracker || null;
            const scenario = {
                correct: 1,
                explanation: 'Context Amnesia strikes when your prompt exceeds the model\'s context window. It repeats earlier sections and forgets new constraints.'
            };

            const elements = {
                options: document.querySelectorAll('.option-btn'),
                feedback: document.getElementById('memoryFeedback'),
                result: document.getElementById('memoryResult'),
                explanation: document.getElementById('memoryExplanation'),
                nextBtn: document.getElementById('memoryNext')
            };

            elements.options.forEach((button) => {
                button.addEventListener('click', () => {
                    if (button.disabled) return;
                    const choice = Number(button.dataset.option);
                    const isCorrect = choice === scenario.correct;
                    elements.options.forEach((btn, idx) => {
                        if (idx === scenario.correct) {
                            btn.classList.add('correct');
                        } else if (idx === choice) {
                            btn.classList.add('incorrect');
                        }
                        btn.disabled = true;
                    });

                    elements.feedback.classList.add('show');
                    elements.feedback.classList.toggle('correct', isCorrect);
                    elements.feedback.classList.toggle('incorrect', !isCorrect);
                    elements.result.innerHTML = isCorrect ? '<strong>‚úÖ Correct.</strong> The context window overflowed.' : '<strong>‚ùå Close.</strong> This is the model forgetting context, not just being dramatic.';
                    elements.explanation.textContent = scenario.explanation;

                    if (elements.nextBtn) {
                        elements.nextBtn.disabled = false;
                    }
                    if (tracker) {
                        tracker.setCheckpoint(LESSON_ID, `${PAGE_ID}_completed`, true);
                    }
                });
            });

            if (tracker) {
                tracker.setCheckpoint(LESSON_ID, PAGE_ID, true);
            }
        });
    </script>
</body>
</html>
