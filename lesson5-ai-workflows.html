<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self';">
    <title>Lesson 5: AI Workflows ÔøΩÔøΩÔøΩ</title>
    <link rel="stylesheet" href="styles/shared.css">
    <script defer src="scripts/nav.js"></script>
    <script defer src="scripts/progress.js"></script>
    <script defer src="scripts/shared.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%);
            min-height: 100vh;
            color: #1a1a1a;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .logo { font-size: 28px; font-weight: bold; color: #00C9FF; }
        .nav { display: flex; gap: 15px; font-size: 14px; }
        .nav a { color: #1a1a1a; text-decoration: none; opacity: 0.7; transition: 0.3s; }
        .nav a:hover { opacity: 1; }
        .stats { display: flex; gap: 20px; }
        .stat-value { font-size: 20px; font-weight: bold; }
        .xp-bar { width: 180px; height: 18px; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, #00C9FF, #92FE9D); transition: width 0.5s; font-size: 11px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .content { display: grid; grid-template-columns: 260px minmax(0, 1fr) 320px; gap: 20px; align-items: start; }
        @media (max-width: 1200px) { .content { grid-template-columns: 1fr; } }
        .sidebar, .panel { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .mode-toggle { display: flex; gap: 15px; justify-content: center; margin-bottom: 25px; }
        .mode-btn {
            background: rgba(0,201,255,0.1);
            border: 2px solid rgba(0,201,255,0.3);
            border-radius: 12px;
            padding: 15px 30px;
            color: #1a1a1a;
            cursor: pointer;
            transition: 0.3s;
            font-size: 16px;
            font-weight: 600;
        }
        .mode-btn.active, .mode-btn:hover { background: rgba(0,201,255,0.2); border-color: #00C9FF; }
        .workflow-canvas {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            min-height: 400px;
            position: relative;
            padding: 20px;
            margin: 20px 0;
        }
        .workflow-node {
            position: absolute;
            background: white;
            border: 3px solid #00C9FF;
            border-radius: 12px;
            padding: 15px 20px;
            min-width: 140px;
            text-align: center;
            cursor: move;
            box-shadow: 0 4px 12px rgba(0,201,255,0.2);
            transition: 0.3s;
        }
        .workflow-node:hover { transform: scale(1.05); box-shadow: 0 8px 24px rgba(0,201,255,0.3); }
        .workflow-node.input { border-color: #92FE9D; background: linear-gradient(135deg, #92FE9D, #00C9FF); color: white; }
        .workflow-node.process { border-color: #00C9FF; }
        .workflow-node.output { border-color: #FFD700; background: linear-gradient(135deg, #FFD700, #FFA500); color: white; }
        .node-icon { font-size: 28px; margin-bottom: 8px; }
        .node-title { font-weight: bold; font-size: 14px; }
        .node-desc { font-size: 11px; opacity: 0.8; margin-top: 4px; }
        .connection-line { position: absolute; height: 3px; background: #00C9FF; transform-origin: left center; }
        .example-workflow {
            background: rgba(0,201,255,0.05);
            border-left: 4px solid #00C9FF;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .activity-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: 0.3s;
        }
        .activity-card:hover { transform: translateY(-5px); border-color: #00C9FF; box-shadow: 0 10px 30px rgba(0,201,255,0.2); }
        .btn-primary {
            background: linear-gradient(135deg, #00C9FF, #92FE9D);
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            color: white;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,201,255,0.3); }
        .hidden { display: none; }
        .progress-item { padding: 8px 0; font-size: 13px; }
        .progress-item.completed { opacity: 0.5; text-decoration: line-through; }
        .progress-item.active { font-weight: bold; color: #00C9FF; }
        .score-panel h3 { font-size: 18px; margin-bottom: 10px; color: #00C9FF; }
        .submission-box { width: 100%; min-height: 140px; padding: 12px; border-radius: 14px; border: 1px solid rgba(0,0,0,0.1); resize: vertical; font-family: inherit; font-size: 14px; }
        .score-output { margin-top: 12px; background: rgba(0,201,255,0.08); border: 1px solid rgba(0,201,255,0.25); border-radius: 14px; padding: 12px; font-size: 14px; min-height: 60px; }
        .score-hint { margin: 12px 0 0 16px; font-size: 13px; color: rgba(0,0,0,0.7); }
        .workflow-mini-card { background: rgba(0,201,255,0.08); border-radius: 12px; padding: 12px; margin-bottom: 10px; border: 1px solid rgba(0,201,255,0.2); }
        .score-panel .btn-primary { width: 100%; margin-top: 10px; }
        .workflow-status { font-size: 11px; letter-spacing: 0.08em; text-transform: uppercase; color: #475569; }
        .workflow-status.completed { color: #047857; }
        .workflow-status.in-progress { color: #b45309; }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.95);
            color: #f8fafc;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px 20px;
            min-width: 250px;
            box-shadow: 0 16px 32px rgba(15, 23, 42, 0.5);
            z-index: 1000;
            animation: slideIn 0.5s;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 25px 0;
            position: relative;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: rgba(0,201,255,0.1);
            border-radius: 10px;
            margin: 0 5px;
            position: relative;
        }
        .step.active { background: linear-gradient(135deg, #00C9FF, #92FE9D); color: white; }
        .step-number { font-size: 24px; font-weight: bold; }
        .step-label { font-size: 12px; margin-top: 5px; }
        .tool-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .tool-card { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px; text-align: center; transition: 0.3s; }
        .tool-card:hover { border-color: #00C9FF; transform: translateY(-3px); }
        .tool-icon { font-size: 36px; margin-bottom: 10px; }
        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }

        /* Drag and Drop Game Styles */
        .builder-container {
            display: grid;
            grid-template-columns: 220px 1fr;
            gap: 20px;
            margin-top: 20px;
            height: 600px;
        }
        @media (max-width: 768px) { .builder-container { grid-template-columns: 1fr; height: auto; } }
        
        .toolbox {
            background: #f8fafc;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toolbox-header { font-size: 14px; font-weight: bold; color: #64748b; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.05em; }
        
        .draggable-item {
            background: white;
            border: 1px solid #cbd5e1;
            border-left: 4px solid #cbd5e1;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: grab;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
            user-select: none;
        }
        .draggable-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-color: #94a3b8; }
        .draggable-item:active { cursor: grabbing; }
        .draggable-item.type-input { border-left-color: #10B981; }
        .draggable-item.type-ai { border-left-color: #00C9FF; }
        .draggable-item.type-logic { border-left-color: #F59E0B; }
        .draggable-item.type-human { border-left-color: #EC4899; }
        .draggable-item.type-output { border-left-color: #6366F1; }

        .workspace {
            background: white;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
        }
        .workspace.drag-over { background: #f0f9ff; border-color: #00C9FF; }

        .drop-slot {
            min-height: 80px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .drop-slot::after {
            content: '‚¨á';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #cbd5e1;
            font-size: 18px;
        }
        .drop-slot:last-child { margin-bottom: 0; }
        .drop-slot:last-child::after { display: none; }

        .placed-node {
            width: 100%;
            max-width: 400px;
            background: white;
            border: 2px solid #00C9FF;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .placed-node .remove-btn {
            color: #ef4444;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            font-size: 16px;
        }
        .placed-node .remove-btn:hover { background: #fee2e2; }

        .mission-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .mission-tab {
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(0,201,255,0.1);
            color: #0077cc;
            border: 1px solid transparent;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }
        .mission-tab.active {
            background: #00C9FF;
            color: white;
            box-shadow: 0 4px 12px rgba(0,201,255,0.3);
        }
        .mission-tab.completed {
            background: #10B981;
            color: white;
        }

        .validation-bar {
            margin-top: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .validation-status { font-weight: bold; font-size: 14px; }
        .validation-status.error { color: #ef4444; }
        .validation-status.success { color: #10B981; }
    </style>
</head>
<body data-lesson-id="lesson5">
    <div class="container">
        <div class="header">
            <div class="logo">üöÄ Lesson 5: AI Workflows</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">XP</div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpBar" style="width: 0%;">
                            <span id="xpText">0/400</span>
                        </div>
                    </div>
                    <div class="xp-readout" id="xpReadout">0/400</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Workflow Points</div>
                    <div class="stat-value"><span id="points">0</span> XP</div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="sidebar">
                <h3 style="margin-bottom: 15px; font-size: 16px;">ÔøΩÔøΩÔøΩ Progress</h3>
                <div class="progress-item completed">‚úÖ L1: Intro</div>
                <div class="progress-item completed">‚úÖ L2: Literacy</div>
                <div class="progress-item completed">‚úÖ L3: Content</div>
                <div class="progress-item completed">‚úÖ L4: Prompting</div>
                <div class="progress-item active">ÔøΩÔøΩÔøΩ L5: Workflows</div>
                <div class="progress-item">ÔøΩÔøΩÔøΩ L6: Capstone</div>
            </div>

            <div class="panel">
                <div class="mode-toggle">
                    <button class="mode-btn" onclick="switchMode('game')" id="gameBtn">üéÆ Game Mode</button>
                    <button class="mode-btn active" onclick="switchMode('present')" id="presentBtn">üìö Learn</button>
                </div>

                <div id="gameMode" class="hidden">
                    <h1 style="font-size: 28px; margin-bottom: 10px; color: #00C9FF;">üèóÔ∏è Workflow Architect</h1>
                    <p style="opacity: 0.8; margin-bottom: 20px;">
                        Drag modules from the toolbox to build the requested AI pipeline. Connect the right tools to solve the client brief!
                    </p>

                    <div class="mission-nav">
                        <div class="mission-tab active" id="tab-content" onclick="loadMission('content')">1. Blog Factory</div>
                        <div class="mission-tab" id="tab-support" onclick="loadMission('support')">2. Support Bot</div>
                        <div class="mission-tab" id="tab-data" onclick="loadMission('data')">3. Data Insight</div>
                    </div>

                    <div style="background: #f0f9ff; border-left: 4px solid #00C9FF; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;">
                        <div id="missionBrief">Loading mission...</div>
                    </div>

                    <div class="builder-container">
                        <div class="toolbox" id="toolbox">
                            <!-- Toolbox items injected by JS -->
                        </div>
                        <div class="workspace" id="workspace" ondragover="allowDrop(event)" ondrop="handleDrop(event)">
                            <div id="dropZone">
                                <!-- Dropped items go here -->
                            </div>
                        </div>
                    </div>

                    <div class="validation-bar">
                        <div id="validationStatus" class="validation-status">Build the workflow above...</div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="resetBuilder()" style="padding: 8px 16px; background: #cbd5e1; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: #475569;">Reset</button>
                            <button onclick="validateWorkflow()" style="padding: 8px 20px; background: #00C9FF; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white;">Validate Workflow</button>
                        </div>
                    </div>












                    

                    
                        <div style="margin-top: 40px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="window.location.href='lesson4-advanced-prompting.html'" style="padding: 16px 32px; background: rgba(0,0,0,0.3); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s;">‚Üê Previous</button>
                            <button onclick="window.location.href='index.html'" style="padding: 16px 32px; background: rgba(0,0,0,0.3); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s;">Main Menu</button>
                            <button onclick="window.location.href='lesson6-capstone.html'" style="padding: 16px 32px; background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s;">Next ‚Üí</button>
                        </div>
                </div>

                <div id="presentMode">
                    <h1 style="font-size: 28px; margin-bottom: 15px; color: #00C9FF;">ÔøΩÔøΩÔøΩ AI Workflow Patterns</h1>

                    <h2 style="font-size: 22px; margin: 25px 0 15px 0; color: #00C9FF;">ÔøΩÔøΩÔøΩ Common Workflow Types</h2>
                    
                    <div class="example-workflow">
                        <h3 style="font-size: 18px; margin-bottom: 10px;">1. Sequential Pipeline</h3>
                        <p style="font-size: 14px; margin-bottom: 10px;">Each AI tool processes output from the previous one.</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 13px;">
                            Input ‚Üí AI 1 (Draft) ‚Üí AI 2 (Edit) ‚Üí AI 3 (Format) ‚Üí Output
                        </div>
                        <p style="font-size: 12px; margin-top: 10px; opacity: 0.8;">‚úÖ Best for: Content creation, data transformation</p>
                    </div>

                    <div class="example-workflow">
                        <h3 style="font-size: 18px; margin-bottom: 10px;">2. Parallel Processing</h3>
                        <p style="font-size: 14px; margin-bottom: 10px;">Multiple AIs work simultaneously on the same input.</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 13px;">
                            Input ‚Üí [AI 1 (Summary) | AI 2 (Keywords) | AI 3 (Sentiment)] ‚Üí Combine ‚Üí Output
                        </div>
                        <p style="font-size: 12px; margin-top: 10px; opacity: 0.8;">‚úÖ Best for: Multi-perspective analysis</p>
                    </div>

                    <div class="example-workflow">
                        <h3 style="font-size: 18px; margin-bottom: 10px;">3. Conditional Routing</h3>
                        <p style="font-size: 14px; margin-bottom: 10px;">AI decides which path to take based on input type.</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 13px;">
                            Input ‚Üí Classifier ‚Üí [If urgent: Fast AI] OR [If complex: Deep AI] ‚Üí Output
                        </div>
                        <p style="font-size: 12px; margin-top: 10px; opacity: 0.8;">‚úÖ Best for: Customer support, triage systems</p>
                    </div>

                    <div class="example-workflow">
                        <h3 style="font-size: 18px; margin-bottom: 10px;">4. Feedback Loop</h3>
                        <p style="font-size: 14px; margin-bottom: 10px;">AI output gets reviewed and refined iteratively.</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 13px;">
                            Input ‚Üí AI Generate ‚Üí Quality Check ‚Üí [If poor: Regenerate] ‚Üí Output
                        </div>
                        <p style="font-size: 12px; margin-top: 10px; opacity: 0.8;">‚úÖ Best for: High-quality output requirements</p>
                    </div>

                    <h2 style="font-size: 22px; margin: 30px 0 15px 0; color: #00C9FF;">ÔøΩÔøΩÔøΩÔ∏è Popular Workflow Tools</h2>
                    <div class="tool-grid">
                        <div class="tool-card">
                            <div class="tool-icon">‚ö°</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">Zapier</div>
                            <div style="font-size: 12px; opacity: 0.8;">No-code automation</div>
                        </div>
                        <div class="tool-card">
                            <div class="tool-icon">ÔøΩÔøΩÔøΩ</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">Make (Integromat)</div>
                            <div style="font-size: 12px; opacity: 0.8;">Visual workflow builder</div>
                        </div>
                        <div class="tool-card">
                            <div class="tool-icon">ÔøΩÔøΩÔøΩ</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">n8n</div>
                            <div style="font-size: 12px; opacity: 0.8;">Open-source automation</div>
                        </div>
                        <div class="tool-card">
                            <div class="tool-icon">ÔøΩÔøΩÔøΩ</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">LangChain</div>
                            <div style="font-size: 12px; opacity: 0.8;">Python framework for LLMs</div>
                        </div>
                        <div class="tool-card">
                            <div class="tool-icon">ÔøΩÔøΩÔøΩ</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">Flowise</div>
                            <div style="font-size: 12px; opacity: 0.8;">Drag-and-drop LLM apps</div>
                        </div>
                        <div class="tool-card">
                            <div class="tool-icon">ÔøΩÔøΩÔøΩ</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">Pipedream</div>
                            <div style="font-size: 12px; opacity: 0.8;">Code + no-code hybrid</div>
                        </div>
                    </div>

                    <h2 style="font-size: 22px; margin: 30px 0 15px 0; color: #00C9FF;">ÔøΩÔøΩÔøΩ Real-World Examples</h2>
                    <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e0e0e0;">
                        <div style="margin-bottom: 20px;">
                            <strong>Marketing Team Workflow:</strong>
                            <div style="margin-top: 8px; padding-left: 15px; font-size: 14px; line-height: 1.8;">
                                1. Topic brainstorm (GPT-5)<br>
                                2. Blog post draft (Claude 3.7)<br>
                                3. Generate images (DALL-E 3)<br>
                                4. SEO optimization (Surfer SEO AI)<br>
                                5. Social media posts (Jasper AI)<br>
                                6. Schedule posts (Buffer/Hootsuite)
                            </div>
                        </div>
                        <div>
                            <strong>Software Development Workflow:</strong>
                            <div style="margin-top: 8px; padding-left: 15px; font-size: 14px; line-height: 1.8;">
                                1. Code generation (GitHub Copilot)<br>
                                2. Security scan (Snyk AI)<br>
                                3. Code review (CodeRabbit)<br>
                                4. Documentation (Mintlify)<br>
                                5. Test generation (Codium AI)<br>
                                6. Deploy (automated CI/CD)
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn-primary" onclick="switchMode('game')">Build Workflows ‚Üí</button>
                    </div>
                    
                    <section class="key-takeaways" aria-label="Lesson 5 key takeaways">
                        <h2 class="section-title">Key Takeaways</h2>
                        <div class="takeaway-grid">
                            <article class="takeaway-card">
                                <span class="takeaway-label">1</span>
                                <h3>Map human checkpoints</h3>
                                <p>Every automation needs review gates‚Äîdecide where humans QA, escalate, or override the model before launching.</p>
                            </article>
                            <article class="takeaway-card">
                                <span class="takeaway-label">2</span>
                                <h3>Separate tools by job</h3>
                                <p>Pair the right model or service with each task (brainstorm, summarize, moderate) instead of forcing one LLM to do everything.</p>
                            </article>
                            <article class="takeaway-card">
                                <span class="takeaway-label">3</span>
                                <h3>Document the flow</h3>
                                <p>Write down triggers, inputs, outputs, and failure states so teammates can audit or refresh the workflow quickly.</p>
                            </article>
                        </div>
                    </section>
                    
                        <div class="footer-nav"></div>
                </div>
            </div>

            <div class="panel score-panel">
                <h3>Mission Control</h3>
                <p style="font-size: 13px; opacity: 0.8; margin-bottom: 12px;">Complete all 3 blueprints to earn your badge.</p>
                
                <div class="workflow-mini-card" id="card-content">
                    <div style="font-weight: bold;">1. Blog Factory</div>
                    <div class="workflow-status">Not started</div>
                </div>
                <div class="workflow-mini-card" id="card-support">
                    <div style="font-weight: bold;">2. Support Bot</div>
                    <div class="workflow-status">Not started</div>
                </div>
                <div class="workflow-mini-card" id="card-data">
                    <div style="font-weight: bold;">3. Data Insight</div>
                    <div class="workflow-status">Not started</div>
                </div>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                    <div style="font-size: 12px; font-weight: bold; color: #64748b; margin-bottom: 5px;">CURRENT MISSION</div>
                    <div id="currentMissionTitle" style="font-weight: bold; color: #00C9FF;">Select a mission...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification hidden"><div id="notificationContent"></div></div>

    <script>
        const LESSON_ID = 'lesson5';
        const CHECKPOINTS = {
            workflowContent: { xp: 150, label: 'Content Pipeline Blueprint' },
            workflowSupport: { xp: 130, label: 'Support Bot Workflow' },
            workflowData: { xp: 120, label: 'Data Insights Workflow' }
        };

        const MISSIONS = {
            content: {
                id: 'workflowContent',
                title: 'Blog Post Factory',
                brief: 'Client needs a blog pipeline: <b>Topic Input</b> ‚Üí <b>Research (GPT)</b> ‚Üí <b>Draft (Claude)</b> ‚Üí <b>Image (DALL-E)</b> ‚Üí <b>Human Review</b> ‚Üí <b>Publish</b>.',
                sequence: ['input-topic', 'ai-research', 'ai-write', 'ai-image', 'human-review', 'output-publish']
            },
            support: {
                id: 'workflowSupport',
                title: 'Support Bot',
                brief: 'Build a smart support system: <b>Ticket Input</b> ‚Üí <b>Classify (AI)</b> ‚Üí <b>Sentiment (AI)</b> ‚Üí <b>Route (Logic)</b> ‚Üí <b>Reply (AI)</b> ‚Üí <b>Email Output</b>.',
                sequence: ['input-ticket', 'ai-classify', 'ai-sentiment', 'logic-route', 'ai-reply', 'output-email']
            },
            data: {
                id: 'workflowData',
                title: 'Data Insight',
                brief: 'Automate a data report: <b>CSV Input</b> ‚Üí <b>Clean Data (Code)</b> ‚Üí <b>Analyze (AI)</b> ‚Üí <b>Chart (AI)</b> ‚Üí <b>Report Output</b>.',
                sequence: ['input-csv', 'code-clean', 'ai-analyze', 'ai-chart', 'output-report']
            }
        };

        const TOOLBOX_ITEMS = [
            { id: 'input-topic', label: 'Topic Input', type: 'input', icon: 'üìù' },
            { id: 'input-ticket', label: 'Ticket Input', type: 'input', icon: 'üé´' },
            { id: 'input-csv', label: 'CSV Upload', type: 'input', icon: 'üìä' },
            { id: 'ai-research', label: 'Research (GPT)', type: 'ai', icon: 'üîç' },
            { id: 'ai-write', label: 'Write (Claude)', type: 'ai', icon: '‚úçÔ∏è' },
            { id: 'ai-image', label: 'Image (DALL-E)', type: 'ai', icon: 'üé®' },
            { id: 'ai-classify', label: 'Classify', type: 'ai', icon: 'üè∑Ô∏è' },
            { id: 'ai-sentiment', label: 'Sentiment', type: 'ai', icon: 'üòä' },
            { id: 'ai-analyze', label: 'Analyze', type: 'ai', icon: 'üìà' },
            { id: 'ai-chart', label: 'Chart Gen', type: 'ai', icon: 'üìâ' },
            { id: 'ai-reply', label: 'Draft Reply', type: 'ai', icon: 'üí¨' },
            { id: 'logic-route', label: 'Route Logic', type: 'logic', icon: 'üîÄ' },
            { id: 'code-clean', label: 'Clean Data', type: 'logic', icon: 'üßπ' },
            { id: 'human-review', label: 'Human Review', type: 'human', icon: 'üëÄ' },
            { id: 'output-publish', label: 'Publish', type: 'output', icon: 'üöÄ' },
            { id: 'output-email', label: 'Send Email', type: 'output', icon: 'üìß' },
            { id: 'output-report', label: 'Save Report', type: 'output', icon: 'üìÅ' }
        ];

        const state = { xp: 0, xpToNext: 400, points: 0, mode: 'game', currentMission: 'content', builder: [] };
        const completedCheckpoints = new Set();
        let tracker = null;
        let appProgress = null;
        let notificationTimer = null;

        document.addEventListener('DOMContentLoaded', () => {
            tracker = window.ProgressTracker || null;
            appProgress = window.AppProgress || null;
            hydrateProgress();
            attachLessonChrome();
            updateUI();
            loadMission('content');
        });

        function hydrateProgress() {
            const saved = tracker ? tracker.getCheckpoints(LESSON_ID) : {};
            state.xp = 0;
            state.points = 0;
            completedCheckpoints.clear();

            Object.entries(CHECKPOINTS).forEach(([id, meta]) => {
                if (saved && saved[id]) {
                    completedCheckpoints.add(id);
                    state.xp += meta.xp;
                }
            });

            if (saved && typeof saved.xpEarned === 'number') {
                state.xp = Math.max(state.xp, Number(saved.xpEarned));
            }

            state.points = state.xp;
            syncLessonStatus();
            updateMissionCards();
        }

        function switchMode(mode) {
            state.mode = mode;
            document.getElementById('gameMode').classList.toggle('hidden', mode !== 'game');
            document.getElementById('presentMode').classList.toggle('hidden', mode !== 'present');
            document.getElementById('gameBtn').classList.toggle('active', mode === 'game');
            document.getElementById('presentBtn').classList.toggle('active', mode === 'present');
        }

        function loadMission(missionKey) {
            state.currentMission = missionKey;
            state.builder = [];
            
            // Update Tabs
            document.querySelectorAll('.mission-tab').forEach(tab => tab.classList.remove('active'));
            const activeTab = document.getElementById(`tab-${missionKey}`);
            if (activeTab) activeTab.classList.add('active');

            // Update Brief
            const mission = MISSIONS[missionKey];
            document.getElementById('missionBrief').innerHTML = `<strong>Mission:</strong> ${mission.brief}`;
            
            // Update Mission Control Title
            const titleEl = document.getElementById('currentMissionTitle');
            if (titleEl) titleEl.textContent = mission.title;

            renderToolbox();
            renderWorkspace();
            updateValidationStatus('Build the workflow above...', 'neutral');
        }

        function renderToolbox() {
            const container = document.getElementById('toolbox');
            if (!container) return;
            container.innerHTML = '<div class="toolbox-header">Modules</div>';
            
            TOOLBOX_ITEMS.forEach(item => {
                const el = document.createElement('div');
                el.className = `draggable-item type-${item.type}`;
                el.draggable = true;
                el.innerHTML = `<span style="font-size: 16px;">${item.icon}</span> ${item.label}`;
                el.addEventListener('dragstart', (e) => handleDragStart(e, item.id));
                container.appendChild(el);
            });
        }

        function renderWorkspace() {
            const container = document.getElementById('dropZone');
            if (!container) return;
            container.innerHTML = '';

            state.builder.forEach((itemId, index) => {
                const item = TOOLBOX_ITEMS.find(i => i.id === itemId);
                if (!item) return;

                const slot = document.createElement('div');
                slot.className = 'drop-slot';
                
                const node = document.createElement('div');
                node.className = 'placed-node';
                node.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">${item.icon}</span>
                        <div>
                            <div style="font-weight: bold; font-size: 14px;">${item.label}</div>
                            <div style="font-size: 11px; opacity: 0.6; text-transform: uppercase;">${item.type}</div>
                        </div>
                    </div>
                    <div class="remove-btn" onclick="removeFromBuilder(${index})">‚úï</div>
                `;
                
                slot.appendChild(node);
                container.appendChild(slot);
            });

            // Empty slot at the end
            const emptySlot = document.createElement('div');
            emptySlot.className = 'drop-slot';
            emptySlot.style.borderStyle = 'dashed';
            emptySlot.style.background = '#f8fafc';
            emptySlot.innerHTML = '<span style="color: #94a3b8; font-size: 13px;">Drag next step here</span>';
            container.appendChild(emptySlot);
        }

        function handleDragStart(e, id) {
            e.dataTransfer.setData('text/plain', id);
            e.dataTransfer.effectAllowed = 'copy';
        }

        function allowDrop(e) {
            e.preventDefault();
            const workspace = document.getElementById('workspace');
            workspace.classList.add('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const workspace = document.getElementById('workspace');
            workspace.classList.remove('drag-over');
            
            const id = e.dataTransfer.getData('text/plain');
            if (id) {
                addToBuilder(id);
            }
        }

        function addToBuilder(id) {
            state.builder.push(id);
            renderWorkspace();
            updateValidationStatus('Drafting...', 'neutral');
        }

        function removeFromBuilder(index) {
            state.builder.splice(index, 1);
            renderWorkspace();
        }

        function resetBuilder() {
            state.builder = [];
            renderWorkspace();
            updateValidationStatus('Reset.', 'neutral');
        }

        function validateWorkflow() {
            const mission = MISSIONS[state.currentMission];
            const currentSequence = state.builder;
            const targetSequence = mission.sequence;

            // Simple check: exact match
            const isMatch = JSON.stringify(currentSequence) === JSON.stringify(targetSequence);

            if (isMatch) {
                updateValidationStatus('‚úÖ Perfect! Workflow validated.', 'success');
                completeCheckpoint(mission.id);
            } else {
                // Provide hints
                if (currentSequence.length < targetSequence.length) {
                    updateValidationStatus('‚ùå Too short. Missing steps.', 'error');
                } else if (currentSequence.length > targetSequence.length) {
                    updateValidationStatus('‚ùå Too long. Remove extra steps.', 'error');
                } else {
                    updateValidationStatus('‚ùå Incorrect order or wrong modules.', 'error');
                }
            }
        }

        function updateValidationStatus(msg, type) {
            const el = document.getElementById('validationStatus');
            if (!el) return;
            el.textContent = msg;
            el.className = `validation-status ${type}`;
        }

        function completeCheckpoint(id) {
            const meta = CHECKPOINTS[id];
            if (!meta) return;
            
            if (!completedCheckpoints.has(id)) {
                completedCheckpoints.add(id);
                if (tracker) tracker.setCheckpoint(LESSON_ID, id, true);
                grantXP(meta.xp, meta.label);
                showNotification(`üéâ Mission Complete: ${meta.label}`);
            } else {
                showNotification(`Mission already completed!`);
            }
            
            updateMissionCards();
            
            // Mark tab as completed
            const tab = document.getElementById(`tab-${state.currentMission}`);
            if (tab) tab.classList.add('completed');
        }

        function updateMissionCards() {
            const cards = {
                workflowContent: document.getElementById('card-content'),
                workflowSupport: document.getElementById('card-support'),
                workflowData: document.getElementById('card-data')
            };

            Object.entries(cards).forEach(([id, el]) => {
                if (!el) return;
                const statusEl = el.querySelector('.workflow-status');
                if (completedCheckpoints.has(id)) {
                    statusEl.textContent = 'Completed';
                    statusEl.className = 'workflow-status completed';
                } else {
                    statusEl.textContent = 'Not started';
                    statusEl.className = 'workflow-status';
                }
            });
        }

        function grantXP(amount, contextLabel) {
            const delta = Number(amount) || 0;
            if (!delta) return;
            state.xp += delta;
            state.points += delta;

            if (tracker) tracker.setCheckpoint(LESSON_ID, 'xpEarned', state.xp);

            if (appProgress && typeof appProgress.addXP === 'function') {
                appProgress.addXP(delta);
            } else if (tracker && typeof tracker.addXP === 'function') {
                tracker.addXP(delta);
            }

            updateUI();
            syncLessonStatus();
        }

        function updateUI() {
            if (window.AILesson && typeof window.AILesson.updateXPBar === 'function') {
                window.AILesson.updateXPBar({ xp: state.xp, xpToNext: state.xpToNext, barId: 'xpBar', textId: 'xpText' });
            } else {
                const pct = Math.min((state.xp / state.xpToNext) * 100, 100);
                document.getElementById('xpBar').style.width = pct + '%';
                document.getElementById('xpText').textContent = `${state.xp}/${state.xpToNext}`;
            }
            const readout = document.getElementById('xpReadout');
            if (readout) {
                readout.textContent = `${state.xp}/${state.xpToNext}`;
            }
            document.getElementById('points').textContent = state.points;
        }

        function showNotification(msg) {
            const wrapper = document.getElementById('notification');
            const content = document.getElementById('notificationContent');
            if (!wrapper || !content) return;
            content.innerHTML = `<div style="font-size: 16px; font-weight: bold; color: #00C9FF;">${msg}</div>`;
            wrapper.classList.remove('hidden');
            clearTimeout(notificationTimer);
            notificationTimer = setTimeout(() => wrapper.classList.add('hidden'), 3200);
        }

        function syncLessonStatus() {
            const total = Object.keys(CHECKPOINTS).length;
            const completed = completedCheckpoints.size;
            if (completed >= total) {
                markLessonComplete();
            } else if (completed > 0) {
                setLessonStatus('in-progress');
            } else {
                setLessonStatus('not-started');
            }
        }

        function markLessonComplete() {
            if (appProgress && typeof appProgress.markLessonComplete === 'function') {
                appProgress.markLessonComplete(LESSON_ID);
            } else if (tracker && typeof tracker.markLessonComplete === 'function') {
                tracker.markLessonComplete(LESSON_ID);
            }
        }

        function setLessonStatus(status) {
            if (appProgress && typeof appProgress.setLessonStatus === 'function') {
                appProgress.setLessonStatus(LESSON_ID, status);
            } else if (tracker && typeof tracker.setLessonStatus === 'function') {
                tracker.setLessonStatus(LESSON_ID, status);
            }
        }

        function attachLessonChrome() {
            if (!window.AILesson) return;
            window.lessonMode = window.AILesson.initModeToggle({
                defaultMode: 'present',
                gamePanelId: 'gameMode',
                presentationPanelId: 'presentMode',
                gameButtonId: 'gameBtn',
                presentationButtonId: 'presentBtn'
            });
            window.AILesson.updateXPBar({ xp: state.xp, xpToNext: state.xpToNext, barId: 'xpBar', textId: 'xpText' });
        }
    </script>
</body>
</html>
